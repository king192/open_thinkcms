<include file="Common/header" />

<include file="Common/body" />
						  <ul class="nav nav-tabs">
						     <li class="active"><a href="{:U('rbac/index')}">角色管理</a></li>
						     <li><a class="auth" href="#" group-id="0">添加角色</a></li>
						  </ul>
							<div class="row-fluid">
								<div class="span12">
									<table id="sample-table-1" class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th>角色名称</th>
												<th>备注</th>
												<th class="hidden-480">Status</th>

												<th>操作</th>
											</tr>
										</thead>

										<tbody>
										<volist name="info" id="v">
											<tr>

												<td>
													<a href="#">{$v['group_name']}</a>
												</td>
												<td>{$v['remark']}</td>
												

												<td class="hidden-480">
													<span class="label label-warning"></span>
												</td>

												<td>
													<div class="hidden-phone visible-desktop btn-group">
														<button class="auth btn btn-mini btn-info" group-id="{$v['id']}">
															<i class="icon-edit bigger-120"></i>
														</button>

														<button class="btn btn-mini btn-danger ajax_del_btn" group-id="{$v['id']}">
															<i class="icon-trash bigger-120"></i>
														</button>
													</div>

													<div class="hidden-desktop visible-phone">
														<div class="inline position-relative">
															<button class="btn btn-minier btn-primary dropdown-toggle" data-toggle="dropdown">
																<i class="icon-cog icon-only bigger-110"></i>
															</button>

															<ul class="dropdown-menu dropdown-icon-only dropdown-yellow pull-right dropdown-caret dropdown-close">
																<li>
																	<a href="#" class="tooltip-info" data-rel="tooltip" title="View">
																		<span class="blue">
																			<i class="icon-zoom-in bigger-120"></i>
																		</span>
																	</a>
																</li>

																<li>
																	<a href="#" class="tooltip-success" data-rel="tooltip" title="Edit">
																		<span class="green">
																			<i class="icon-edit bigger-120"></i>
																		</span>
																	</a>
																</li>

																<li>
																	<a href="#" class="tooltip-error" data-rel="tooltip" title="Delete">
																		<span class="red">
																			<i class="icon-trash bigger-120"></i>
																		</span>
																	</a>
																</li>
															</ul>
														</div>
													</div>
												</td>
											</tr>
											</volist>
										</tbody>
									</table>
								</div><!--/span-->
							</div><!--/row-->

							<!--PAGE CONTENT ENDS-->
						</div><!--/.span-->
					</div><!--/.row-fluid-->
				</div><!--/.page-content-->

				<div class="ace-settings-container" id="ace-settings-container">
					<div class="btn btn-app btn-mini btn-warning ace-settings-btn" id="ace-settings-btn">
						<i class="icon-cog bigger-150"></i>
					</div>

					<div class="ace-settings-box" id="ace-settings-box">
						<div>
							<div class="pull-left">
								<select id="skin-colorpicker" class="hide">
									<option data-class="default" value="#438EB9" />#438EB9
									<option data-class="skin-1" value="#222A2D" />#222A2D
									<option data-class="skin-2" value="#C6487E" />#C6487E
									<option data-class="skin-3" value="#D0D0D0" />#D0D0D0
								</select>
							</div>
							<span>&nbsp; Choose Skin</span>
						</div>

						<div>
							<input type="checkbox" class="ace-checkbox-2" id="ace-settings-header" />
							<label class="lbl" for="ace-settings-header"> Fixed Header</label>
						</div>

						<div>
							<input type="checkbox" class="ace-checkbox-2" id="ace-settings-sidebar" />
							<label class="lbl" for="ace-settings-sidebar"> Fixed Sidebar</label>
						</div>

						<div>
							<input type="checkbox" class="ace-checkbox-2" id="ace-settings-breadcrumbs" />
							<label class="lbl" for="ace-settings-breadcrumbs"> Fixed Breadcrumbs</label>
						</div>

						<div>
							<input type="checkbox" class="ace-checkbox-2" id="ace-settings-rtl" />
							<label class="lbl" for="ace-settings-rtl"> Right To Left (rtl)</label>
						</div>
					</div>
				</div><!--/#ace-settings-container-->
			</div><!--/.main-content-->
		</div><!--/.main-container-->

		<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-small btn-inverse">
			<i class="icon-double-angle-up icon-only bigger-110"></i>
		</a>

		<!--basic scripts-->

		<!--[if !IE]>-->

		<script src="http://cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>

		<!--<![endif]-->

		<!--[if IE]>
		<script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
<![endif]-->

		<!--[if !IE]>-->

		<script type="text/javascript">
			window.jQuery || document.write("<script src='__PUBLIC__/assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
		</script>

		<!--<![endif]-->

		<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='__PUBLIC__/assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->

		<script type="text/javascript">
			if("ontouchend" in document) document.write("<script src='__PUBLIC__/assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>
		<script src="__PUBLIC__/assets/js/bootstrap.min.js"></script>

		<!--page specific plugin scripts-->

		<!-- <script src="__PUBLIC__/assets/js/fuelux/data/fuelux.tree-sampledata.js"></script>
		<script src="__PUBLIC__/assets/js/fuelux/fuelux.tree.min.js"></script> -->

		<!--ace scripts-->

		<script src="__PUBLIC__/assets/js/ace-elements.min.js"></script>
		<script src="__PUBLIC__/assets/js/ace.min.js"></script>

		<!--inline scripts related to this page-->


		
		<include file="Common/source" />
		<include file="Common/modal" />

<!-- ztree -->
		
	<link rel="stylesheet" href="__PUBLIC__/ztree/css/zTreeStyle.css" type="text/css">
	<script type="text/javascript" src="__PUBLIC__/ztree/js/jquery.ztree.core-3.5.js"></script>
	<script type="text/javascript" src="__PUBLIC__/ztree/js/jquery.ztree.exedit-3.5.js"></script>
	<script type="text/javascript" src="__PUBLIC__/ztree/js/jquery.ztree.excheck-3.5.js"></script>

		<script type="text/javascript">
		Array.prototype.removes = function(b) { 
				var a = this.indexOf(b); 
				if (a >= 0) { 
				this.splice(a, 1); 
				return true; 
				} 
				return false; 
			}; 
			var setting = {
			view: {
				selectedMulti: false
			},
			check: {
				enable: true
			},
			data: {
				simpleData: {
					enable: true
				}
			},
			callback: {
				beforeCheck: beforeCheck,
				onCheck: onCheck
			}
		};
		var auth_id = [];
		var group_id = 0;
		function beforeCheck(treeId, treeNode) {
			// auth_id = [];
		}
		function onCheck(e, treeId, treeNode) {
			if(treeNode.checked == true){
				auth_id.push(treeNode.id);
			}else{
				auth_id.removes(treeNode.id);
			}
		}		
		// var zNodes = <?php //echo $menu; ?>;
		// var zNodes =[
		// 	{ id:1, parentid:0, name:"父节点1 - 展开",checked:true},
		// 	{ id:2, parentid:1, name:"父节点11 - 折叠"},
		// 	{ id:3, parentid:1, name:"叶子节点111",checked:true},
		// 	{ id:4, parentid:3, name:"叶子节点112"},
		// 	{ id:5, parentid:1, name:"叶子节点113"},
		// 	{ id:6, parentid:3, name:"叶子节点114",checked:true}
		// ];
		$(document).ready(function(){
			$('.auth').click(function(){
				auth_id = [];//初始化为空
				group_id = $(this).attr('group-id');
				$.ajax({
					url:"{:U('get_list')}",
					dataType:"JSON",
					type:"POST",
					data:{group_id:group_id},
					success:function(data){
						var html = '<div class="common-form"><form method="post" class="form-horizontal J_ajaxForm" action="{:U("AdminGroup/add_group_post")}"><div class="form-group"><label for="name">管理组名</label><input type="text" class="input" name="group_name" value="'+data.data.group_name+'"><div class="form-group"><label for="name">备注</label><textarea name="remark" class="form-control" rows="3" value="">'+data.data.remark+'</textarea></div></div><ul id="treeDemo" class="ztree"></ul><div class="form-actions"><button type="submit" class="btn btn-primary btn_submit  J_ajax_submit_btn1">更新</button><button class="btn J_ajax_close_btn1"type="submit" data-dismiss="modal" aria-hidden="true">关闭</button></div></form></div>';
						var zNodes = $.parseJSON(data.msg);
						$('.modal-body').html(html);
						auth_id = data.data.auth_id;
						$.fn.zTree.init($("#treeDemo"), setting, zNodes);
						$('#myModal').modal();
						zTree = $.fn.zTree.getZTreeObj("treeDemo");
						zTree.setting.check.autoCheckTrigger = true;
					},
					error:function(e){
						console.log('e',e);
					}
				})
			})
		});
		$(function(){
			$(document).on('click','.J_ajax_submit_btn1',function(){
				console.log('auth_id',auth_id);
				var group_name = $("input[name=group_name]").val();
					remark = $("textarea[name=remark]").val();
					console.log('remark',remark);
				$.ajax({
					url:"{:U('AdminGroup/group_post')}",
					type:"POST",
					dataType:"JSON",
					data:{group_name:group_name,remark:remark,auth_id:auth_id,group_id:group_id},
					success:function(data){
						console.log('ss',data);
						if(data.rtn>0){
							show(data.msg);
						}else{
							warning(data.msg);
						}
					},
					error:function(e){
						console.log('e',e);
					}
				})
				return false;
			})
			$(document).on('click','.ajax_del_btn',function(){
				console.log('auth_id',auth_id);
				confirm('确定删除吗？');
				group_id = $(this).attr('group-id');
				$.ajax({
					url:"{:U('AdminGroup/del_group')}",
					type:"POST",
					dataType:"JSON",
					data:{group_id:group_id},
					success:function(data){
						console.log('ss',data);
						if(data.rtn>0){
							show(data.msg);
						}else{
							warning(data.msg);
						}
					},
					error:function(e){
						console.log('e',e);
					}
				})
				return false;
			})
		})
		</script>
	</body>
</html>
