<include file="Common/header" />

<include file="Common/body" />
						  <ul class="nav nav-tabs">
						     <li class="active"><a href="{:U('rbac/index')}">用户列表</a></li>
						  </ul>
							<div class="row-fluid">
								<div class="span12">
									<table id="sample-table-1" class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th>用户id</th>
												<th>用户名</th>
												<th>积分</th>
												<th>email</th>
												<th>最后登录时间</th>
												<th>登陆次数</th>
												<th class="hidden-480">是否禁用</th>

												<th>操作</th>
											</tr>
										</thead>

										<tbody>
										<volist name="info" id="v">
											<tr>
												<td>{$v['id']}</td>
												<td>
													<a href="#">{$v['username']}</a>
												</td>
												<td>{$v['credit']}</td>
												<td>{$v['email']}</td>
												<td><?php echo date('Y-m-d H:i:s',$v['lastlgtm']);?></td>
												<td>{$v.login_times}</td>
												

												<td class="hidden-480">
													<if condition="$v.isdisabled eq 1">
													是
													<else/>
													否
													</if>
												</td>

												<td>
													<div class="hidden-phone visible-desktop btn-group">
														<button class="auth btn btn-mini btn-info" uid="{$v['id']}">
															<i class="icon-edit bigger-120"></i>
														</button>

														<button class="btn btn-mini btn-danger ajax_del_btn" group-id="{$v['id']}">
															<if condition="$v.is_allowed eq 1">
																<i class="icon-key bigger-120" title="启用"></i>
															<else/>
																<i class="icon-unlock bigger-120" title="禁用"></i>
															</if>
															
														</button>
													</div>

													<div class="hidden-desktop visible-phone">
														<div class="inline position-relative">
															<button class="btn btn-minier btn-primary dropdown-toggle" data-toggle="dropdown">
																<i class="icon-cog icon-only bigger-110"></i>
															</button>

															<ul class="dropdown-menu dropdown-icon-only dropdown-yellow pull-right dropdown-caret dropdown-close">
																<li>
																	<a href="#" class="tooltip-info" data-rel="tooltip" title="View">
																		<span class="blue">
																			<i class="icon-zoom-in bigger-120"></i>
																		</span>
																	</a>
																</li>

																<li>
																	<a href="#" class="tooltip-success" data-rel="tooltip" title="Edit">
																		<span class="green">
																			<i class="icon-edit bigger-120"></i>
																		</span>
																	</a>
																</li>

																<li>
																	<a href="#" class="tooltip-error" data-rel="tooltip" title="Delete">
																		<span class="red">
																			<i class="icon-trash bigger-120"></i>
																		</span>
																	</a>
																</li>
															</ul>
														</div>
													</div>
												</td>
											</tr>
											</volist>
										</tbody>
									</table>
									<div class="">
										{$page}
									</div>
								</div><!--/span-->
							</div><!--/row-->

							<!--PAGE CONTENT ENDS-->
						</div><!--/.span-->
					</div><!--/.row-fluid-->
				</div><!--/.page-content-->

				<div class="ace-settings-container" id="ace-settings-container">
					<div class="btn btn-app btn-mini btn-warning ace-settings-btn" id="ace-settings-btn">
						<i class="icon-cog bigger-150"></i>
					</div>

					<div class="ace-settings-box" id="ace-settings-box">
						<div>
							<div class="pull-left">
								<select id="skin-colorpicker" class="hide">
									<option data-class="default" value="#438EB9" />#438EB9
									<option data-class="skin-1" value="#222A2D" />#222A2D
									<option data-class="skin-2" value="#C6487E" />#C6487E
									<option data-class="skin-3" value="#D0D0D0" />#D0D0D0
								</select>
							</div>
							<span>&nbsp; Choose Skin</span>
						</div>

						<div>
							<input type="checkbox" class="ace-checkbox-2" id="ace-settings-header" />
							<label class="lbl" for="ace-settings-header"> Fixed Header</label>
						</div>

						<div>
							<input type="checkbox" class="ace-checkbox-2" id="ace-settings-sidebar" />
							<label class="lbl" for="ace-settings-sidebar"> Fixed Sidebar</label>
						</div>

						<div>
							<input type="checkbox" class="ace-checkbox-2" id="ace-settings-breadcrumbs" />
							<label class="lbl" for="ace-settings-breadcrumbs"> Fixed Breadcrumbs</label>
						</div>

						<div>
							<input type="checkbox" class="ace-checkbox-2" id="ace-settings-rtl" />
							<label class="lbl" for="ace-settings-rtl"> Right To Left (rtl)</label>
						</div>
					</div>
				</div><!--/#ace-settings-container-->
			</div><!--/.main-content-->
		</div><!--/.main-container-->

		<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-small btn-inverse">
			<i class="icon-double-angle-up icon-only bigger-110"></i>
		</a>

		<!--basic scripts-->

		<!--[if !IE]>-->

		<script src="http://cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>

		<!--<![endif]-->

		<!--[if IE]>
		<script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
<![endif]-->

		<!--[if !IE]>-->

		<script type="text/javascript">
			window.jQuery || document.write("<script src='__PUBLIC__/assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
		</script>

		<!--<![endif]-->

		<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='__PUBLIC__/assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->

		<script type="text/javascript">
			if("ontouchend" in document) document.write("<script src='__PUBLIC__/assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>
		<script src="__PUBLIC__/assets/js/bootstrap.min.js"></script>

		<!--page specific plugin scripts-->

		<!-- <script src="__PUBLIC__/assets/js/fuelux/data/fuelux.tree-sampledata.js"></script>
		<script src="__PUBLIC__/assets/js/fuelux/fuelux.tree.min.js"></script> -->

		<!--ace scripts-->

		<script src="__PUBLIC__/assets/js/ace-elements.min.js"></script>
		<script src="__PUBLIC__/assets/js/ace.min.js"></script>

		<!--inline scripts related to this page-->


		
		<include file="Common/source" />
		<include file="Common/modal" />

<!-- ztree -->
		
	<!-- <link rel="stylesheet" href="__PUBLIC__/ztree/css/zTreeStyle.css" type="text/css">
	<script type="text/javascript" src="__PUBLIC__/ztree/js/jquery.ztree.core-3.5.js"></script>
	<script type="text/javascript" src="__PUBLIC__/ztree/js/jquery.ztree.exedit-3.5.js"></script>
	<script type="text/javascript" src="__PUBLIC__/ztree/js/jquery.ztree.excheck-3.5.js"></script> -->

		<script type="text/javascript">
		$(document).ready(function(){
			$('.auth').click(function(){
				auth_id = [];//初始化为空
				uid = $(this).attr('uid');
				$.ajax({
					url:"{:U('get_list')}",
					dataType:"JSON",
					type:"POST",
					data:{uid:uid},
					success:function(data){
						var html = '<div class="common-form"><form method="post" class="form-horizontal J_ajaxForm" action="{:U("AdminUser/admin_post")}"><div class="form-group"><label for="name">用户名</label><input type="text" class="input" name="username" value="'+data.data.username+'"></div><div class="form-group"><label for="name">密码</label><input type="text" class="input" name="passwd" value="" placeholder="'+data.data.passwd+'"></div><div class="form-group"><label for="name">邮箱</label><input type="text" class="input" name="email" value="'+data.data.email+'"></div><div class="row" style="margin:auto;">'+data.msg+'</div><div class="form-actions"><button type="submit" class="btn btn-primary btn_submit  J_ajax_submit_btn1">更新</button><button class="btn J_ajax_close_btn1"type="submit">关闭</button></div></form></div>';
						$('.modal-body').html(html);
						auth_id = data.data.auth_id;
						flag_username = data.data.username;
						flag_email = data.data.email;
						$('#myModal').modal();
					},
					error:function(e){
						console.log('e',e);
					}
				})
			})
		});
		$(function(){
			$(document).on('click','.J_ajax_submit_btn1',function(){
				console.log('auth_id',auth_id);
				var username = $("input[name=username]").val() == flag_username?"":$("input[name=username]").val(),
					passwd = $("input[name=passwd]").val(),
					email = $("input[name=email]").val()==flag_email?"":$("input[name=email]").val(),
					group = [];
					$("input[name=group]:checked").each(function(){
						group.push($(this).val());
					});
					console.log('passwd',passwd);
					console.log('group',group);
				$.ajax({
					url:"{:U('AdminUser/admin_post')}",
					type:"POST",
					dataType:"JSON",
					data:{username:username,passwd:passwd,email:email,uid:uid,group:group},
					success:function(data){
						console.log('ss',data);
						if(data.rtn>0){
							show(data.msg);
						}else{
							warning(data.msg);
						}
					},
					error:function(e){
						console.log('e',e);
					}
				})
				return false;
			})
			$(document).on('click','.ajax_del_btn',function(){
				console.log('auth_id',auth_id);
				confirm('确定删除吗？');
				group_id = $(this).attr('group-id');
				$.ajax({
					url:"{:U('AdminGroup/del_group')}",
					type:"POST",
					dataType:"JSON",
					data:{group_id:group_id},
					success:function(data){
						console.log('ss',data);
						if(data.rtn>0){
							show(data.msg);
						}else{
							warning(data.msg);
						}
					},
					error:function(e){
						console.log('e',e);
					}
				})
				return false;
			})
		})
		</script>
	</body>
</html>
